{"version":3,"file":"index.js","sources":["../lib/requesttoken.ts","../lib/user.ts"],"sourcesContent":["import { subscribe } from '@nextcloud/event-bus'\n\nconst tokenElement = document.getElementsByTagName('head')[0]\nlet token = tokenElement ? tokenElement.getAttribute('data-requesttoken') : null\n\nexport interface CsrfTokenObserver {\n\t(token: string): void;\n}\n\nconst observers: CsrfTokenObserver[] = []\n\nexport function getRequestToken(): string | null {\n\treturn token\n}\n\nexport function onRequestTokenUpdate(observer: CsrfTokenObserver): void {\n\tobservers.push(observer)\n}\n\n// Listen to server event and keep token in sync\nsubscribe('csrf-token-update', e => {\n\ttoken = e.token\n\n\tobservers.forEach(observer => {\n\t\ttry {\n\t\t\tobserver(e.token)\n\t\t} catch (e) {\n\t\t\tconsole.error('error updating CSRF token observer', e)\n\t\t}\n\t})\n})\n","/// <reference types=\"@nextcloud/typings\" />\n\ndeclare var OC: Nextcloud.v16.OC\n\t| Nextcloud.v17.OC\n\t| Nextcloud.v18.OC\n\t| Nextcloud.v19.OC\n\t| Nextcloud.v20.OC\n\t| Nextcloud.v21.OC\n\t| Nextcloud.v22.OC\n\t| Nextcloud.v20.OC\n\t| Nextcloud.v24.OC;\n\nconst getAttribute = (el: HTMLHeadElement | undefined, attribute: string): string | null => {\n\tif (el) {\n\t\treturn el.getAttribute(attribute)\n\t}\n\n\treturn null\n}\n\nconst head = document.getElementsByTagName('head')[0]\nconst uid = getAttribute(head, 'data-user')\nconst displayName = getAttribute(head, 'data-user-displayname')\n\nconst isAdmin = (typeof OC === 'undefined')\n\t? false\n\t: OC.isUserAdmin()\n\nexport interface NextcloudUser {\n\tuid: String,\n\tdisplayName: String | null,\n\tisAdmin: Boolean,\n}\n\nexport function getCurrentUser(): NextcloudUser | null {\n\tif (uid === null) {\n\t\treturn null\n\t}\n\n\treturn {\n\t\tuid,\n\t\tdisplayName,\n\t\tisAdmin,\n\t} as NextcloudUser\n}\n"],"names":["subscribe"],"mappings":";;;;;;AAEA,IAAM,YAAY,GAAG,QAAQ,CAAC,oBAAoB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAA;AAC7D,IAAI,KAAK,GAAG,YAAY,GAAG,YAAY,CAAC,YAAY,CAAC,mBAAmB,CAAC,GAAG,IAAI,CAAA;AAMhF,IAAM,SAAS,GAAwB,EAAE,CAAA;SAEzB,eAAe,GAAA;AAC9B,IAAA,OAAO,KAAK,CAAA;AACb,CAAC;AAEK,SAAU,oBAAoB,CAAC,QAA2B,EAAA;AAC/D,IAAA,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;AACzB,CAAC;AAED;AACAA,kBAAS,CAAC,mBAAmB,EAAE,UAAA,CAAC,EAAA;AAC/B,IAAA,KAAK,GAAG,CAAC,CAAC,KAAK,CAAA;AAEf,IAAA,SAAS,CAAC,OAAO,CAAC,UAAA,QAAQ,EAAA;QACzB,IAAI;AACH,YAAA,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAA;AACjB,SAAA;AAAC,QAAA,OAAO,CAAC,EAAE;AACX,YAAA,OAAO,CAAC,KAAK,CAAC,oCAAoC,EAAE,CAAC,CAAC,CAAA;AACtD,SAAA;AACF,KAAC,CAAC,CAAA;AACH,CAAC,CAAC;;AC9BF;AAYA,IAAM,YAAY,GAAG,UAAC,EAA+B,EAAE,SAAiB,EAAA;AACvE,IAAA,IAAI,EAAE,EAAE;AACP,QAAA,OAAO,EAAE,CAAC,YAAY,CAAC,SAAS,CAAC,CAAA;AACjC,KAAA;AAED,IAAA,OAAO,IAAI,CAAA;AACZ,CAAC,CAAA;AAED,IAAM,IAAI,GAAG,QAAQ,CAAC,oBAAoB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAA;AACrD,IAAM,GAAG,GAAG,YAAY,CAAC,IAAI,EAAE,WAAW,CAAC,CAAA;AAC3C,IAAM,WAAW,GAAG,YAAY,CAAC,IAAI,EAAE,uBAAuB,CAAC,CAAA;AAE/D,IAAM,OAAO,GAAG,CAAC,OAAO,EAAE,KAAK,WAAW;AACzC,MAAE,KAAK;AACP,MAAE,EAAE,CAAC,WAAW,EAAE,CAAA;SAQH,cAAc,GAAA;IAC7B,IAAI,GAAG,KAAK,IAAI,EAAE;AACjB,QAAA,OAAO,IAAI,CAAA;AACX,KAAA;IAED,OAAO;AACN,QAAA,GAAG,EAAA,GAAA;AACH,QAAA,WAAW,EAAA,WAAA;AACX,QAAA,OAAO,EAAA,OAAA;KACU,CAAA;AACnB;;;;;;"}
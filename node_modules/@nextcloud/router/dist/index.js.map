{"version":3,"file":"index.js","names":["linkTo","app","file","generateFilePath","linkToRemoteBase","service","getRootUrl","generateRemoteUrl","window","location","protocol","host","generateOcsUrl","url","params","options","allOptions","Object","assign","ocsVersion","version","_generateUrlPath","escape","_build","text","vars","replace","a","b","r","encodeURIComponent","toString","charAt","generateUrl","noRewrite","OC","config","modRewriteWorking","imagePath","indexOf","type","isCore","coreApps","link","substring","length","encodeURI","appswebroots","webroot"],"sources":["../lib/index.ts"],"sourcesContent":["/// <reference types=\"@nextcloud/typings\" />\n\ndeclare global {\n    interface Window {\n        OC: Nextcloud.v16.OC | Nextcloud.v17.OC | Nextcloud.v18.OC | Nextcloud.v19.OC | Nextcloud.v20.OC;\n    }\n}\n\n/**\n * Get an url with webroot to a file in an app\n *\n * @param {string} app the id of the app the file belongs to\n * @param {string} file the file path relative to the app folder\n * @return {string} URL with webroot to a file\n */\nexport const linkTo = (app: string, file: string) => generateFilePath(app, '', file)\n\n/**\n * Creates a relative url for remote use\n *\n * @param {string} service id\n * @return {string} the url\n */\nconst linkToRemoteBase = (service: string) => getRootUrl() + '/remote.php/' + service\n\n/**\n * @brief Creates an absolute url for remote use\n * @param {string} service id\n * @return {string} the url\n */\nexport const generateRemoteUrl = (service: string) => window.location.protocol + '//' + window.location.host + linkToRemoteBase(service)\n\n/**\n * Get the base path for the given OCS API service\n *\n * @param {string} url OCS API service url\n * @param {object} params parameters to be replaced into the service url\n * @param {UrlOptions} options options for the parameter replacement\n * @param {boolean} options.escape Set to false if parameters should not be URL encoded (default true)\n * @param {Number} options.ocsVersion OCS version to use (defaults to 2)\n * @return {string} Absolute path for the OCS URL\n */\nexport const generateOcsUrl = (url: string, params?: object, options?: UrlOptions) => {\n    const allOptions = Object.assign({\n        ocsVersion: 2\n    }, options || {})\n\n   const version = (allOptions.ocsVersion === 1) ? 1 : 2\n\n    return window.location.protocol + '//' + window.location.host + getRootUrl() + '/ocs/v' + version + '.php' + _generateUrlPath(url, params, options);\n}\n\nexport interface UrlOptions {\n    escape: boolean,\n    noRewrite: boolean,\n    ocsVersion: Number\n}\n\n/**\n * Generate a url path, which can contain parameters\n *\n * Parameters will be URL encoded automatically\n *\n * @param {string} url address (can contain placeholders e.g. /call/{token} would replace {token} with the value of params.token\n * @param {object} params parameters to be replaced into the address\n * @param {UrlOptions} options options for the parameter replacement\n * @return {string} Path part for the given URL\n */\nconst _generateUrlPath = (url: string, params?: object, options?: UrlOptions) => {\n    const allOptions = Object.assign({\n        escape: true\n    }, options || {})\n\n    const _build = function (text: string, vars: object) {\n        vars = vars || {};\n        return text.replace(/{([^{}]*)}/g,\n            function (a: string, b: any) {\n                var r = vars[b];\n                if (allOptions.escape) {\n                    return (typeof r === 'string' || typeof r === 'number') ? encodeURIComponent(r.toString()) : encodeURIComponent(a);\n                } else {\n                    return (typeof r === 'string' || typeof r === 'number') ? r.toString() : a;\n                }\n            }\n        );\n    };\n\n    if (url.charAt(0) !== '/') {\n        url = '/' + url;\n    }\n\n    return _build(url, params || {});\n}\n\n/**\n * Generate the url with webroot for the given relative url, which can contain parameters\n *\n * Parameters will be URL encoded automatically\n *\n * @param {string} url address (can contain placeholders e.g. /call/{token} would replace {token} with the value of params.token\n * @param {object} params parameters to be replaced into the url\n * @param {UrlOptions} options options for the parameter replacement\n * @param {boolean} options.noRewrite True if you want to force index.php being added\n * @param {boolean} options.escape Set to false if parameters should not be URL encoded (default true)\n * @return {string} URL with webroot for the given relative URL\n */\nexport const generateUrl = (url: string, params?: object, options?: UrlOptions) => {\n    const allOptions = Object.assign({\n        noRewrite: false\n    }, options || {})\n\n    if (window?.OC?.config?.modRewriteWorking === true && !allOptions.noRewrite) {\n        return getRootUrl() + _generateUrlPath(url, params, options);\n    }\n\n    return getRootUrl() + '/index.php' + _generateUrlPath(url, params, options);\n}\n\n/**\n * Get the path with webroot to an image file\n * if no extension is given for the image, it will automatically decide\n * between .png and .svg based on what the browser supports\n *\n * @param {string} app the app id to which the image belongs\n * @param {string} file the name of the image file\n * @return {string}\n */\nexport const imagePath = (app: string, file: string) => {\n    if (file.indexOf('.') === -1) {\n        //if no extension is given, use svg\n        return generateFilePath(app, 'img', file + '.svg')\n    }\n\n    return generateFilePath(app, 'img', file)\n}\n\n/**\n * Get the url with webroot for a file in an app\n *\n * @param {string} app the id of the app\n * @param {string} type the type of the file to link to (e.g. css,img,ajax.template)\n * @param {string} file the filename\n * @return {string} URL with webroot for a file in an app\n */\nexport const generateFilePath = (app: string, type: string, file: string) => {\n    const isCore = window?.OC?.coreApps?.indexOf(app) !== -1\n    let link = getRootUrl()\n    if (file.substring(file.length - 3) === 'php' && !isCore) {\n        link += '/index.php/apps/' + app;\n        if (file !== 'index.php') {\n            link += '/'\n            if (type) {\n                link += encodeURI(type + '/')\n            }\n            link += file\n        }\n    } else if (file.substring(file.length - 3) !== 'php' && !isCore) {\n        link = window?.OC?.appswebroots?.[app];\n        if (type) {\n            link += '/' + type + '/'\n        }\n        if (link.substring(link.length - 1) !== '/') {\n            link += '/'\n        }\n        link += file\n    } else {\n        if ((app === 'settings' || app === 'core' || app === 'search') && type === 'ajax') {\n            link += '/index.php/'\n        } else {\n            link += '/'\n        }\n        if (!isCore) {\n            link += 'apps/'\n        }\n        if (app !== '') {\n            app += '/'\n            link += app\n        }\n        if (type) {\n            link += type + '/'\n        }\n        link += file\n    }\n    return link\n}\n\n/**\n * Return the web root path where this Nextcloud instance\n * is accessible, with a leading slash.\n * For example \"/nextcloud\".\n *\n * @return {string} web root path\n */\nexport const getRootUrl = () => window?.OC?.webroot || ''\n"],"mappings":"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"}